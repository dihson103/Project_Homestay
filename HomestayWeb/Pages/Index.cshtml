@page
@model IndexModel
@{
    ViewData["Title"] = "Home page";
}
<link href="~/css/Home.css" rel="stylesheet" />
<div class="text-center" style="">
    <h1 style="color:#5c5d5e;margin-bottom:20px;">CONTINENTAL HOMESTAY </h1>
</div>

<form method="post" class="search">
    <input type="text" name="searchString" placeholder="Nhập Homestay bạn muốn tìm ..."/>
    <div class="form-group">
        <select class="form-control" id="province">
              <option value="" class="text-primary">Chọn City</option>
         </select>
    </div>
    <div class="form-group">
        <select class="form-control" id="district">
            <option value="" class="text-primary">Chọn huyện</option>
        </select>
    </div>
    <div class="form-group">
        <select class="form-control" id="ward">
            <option value="" class="text-primary">Chọn xã</option>
        </select>
    </div>
    <button type="submit" class="search-button">
        Tìm kiếm
    </button>
</form>

<div class="container">
    <div class="row row-cols-1 row-cols-md-4">
        @foreach(var homestay in Model.Homestays)
        {
        <div class="col mb-4" style="height:400px">
            <div class="homestay">
                <a href="/HomeStays/Details?id=@homestay.HomestayId" style="text-decoration:none">
                    <img src="@homestay.Images.First().Link" class="card-img-top" alt="..." style="margin-bottom: 20px;">
                    <div class="overlay">
                        <h5 class="card-title" style="color:black">@homestay.HomestayName</h5>
                        <p class="card-text" style="color: black">@homestay.Price$ / night</p>
                    </div>
                </a>
            </div>
        </div>
        }
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.26.1/axios.min.js" integrity="sha512-bPh3uwgU5qEMipS/VOmRqynnMXGGSRv+72H/N260MQeXZIK4PG48401Bsby9Nq5P5fz7hy5UGNmC/W1Z51h2GQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>


<script>
    const host = "https://provinces.open-api.vn/api/";
    var callAPI = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data, "province");
            });
    }
    var callApiDistrict = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data.districts, "district");
            });
    }
    var callApiWard = (api) => {
        return axios.get(api)
            .then((response) => {
                renderData(response.data.wards, "ward");
            });
    }

    var renderData = (array, select) => {
        let row = ' <option value="">chọn</option>';
        array.forEach(element => {
            row += `<option value="${element.code}">${element.name}</option>`
        });
        document.querySelector("#" + select).innerHTML = row
    }

    var isClickFirst = true;

    $("#province").click(() => {
        if (isClickFirst) {
            callAPI('https://provinces.open-api.vn/api/?depth=1');
            isClickFirst = false;
        }
    })

    $("#province").change(() => {
        axios.get("https://provinces.open-api.vn/api/p/" + $("#province").val())
            .then((response) => {
                $('#provinceInput').val(response.data.name)
            });
        callApiDistrict(host + "p/" + $("#province").val() + "?depth=2");
        $('#province option:first').prop('disabled', true);
        $('#districtInput').val('');
        $('#wardInput').val('');
    });
    $("#district").change(() => {
        axios.get("https://provinces.open-api.vn/api/d/" + $("#district").val())
            .then((response) => {
                $('#districtInput').val(response.data.name)
            });
        callApiWard(host + "d/" + $("#district").val() + "?depth=2");
        $('#district option:first').prop('disabled', true);
        $('#wardInput').val('');
    });
    $("#ward").change(() => {
        axios.get("https://provinces.open-api.vn/api/w/" + $("#ward").val())
            .then((response) => {
                $('#wardInput').val(response.data.name)
            });
        $('#ward option:first').prop('disabled', true);
    })
</script>



